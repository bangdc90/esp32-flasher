<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dasai Mochi ESP32-C3 Flasher</title>
  <script src="https://esp.huhn.me/webflash.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      max-width: 960px;
    }
    h2 {
      color: #1976d2;
    }
    .flasher-container {
      display: flex;
      gap: 32px;
      align-items: flex-start;
      margin-bottom: 40px;
    }
    esp-web-flasher {
      flex: 1;
      min-width: 300px;
    }
    #log-output {
      flex: 1;
      background: #0f0f0f;
      color: #eee;
      font-family: monospace;
      padding: 12px;
      border-radius: 8px;
      height: 300px;
      overflow-y: auto;
      font-size: 0.9em;
      white-space: pre-wrap;
    }
    #readme-container {
      background: #f9f9f9;
      padding: 24px;
      border-radius: 8px;
      margin-top: 40px;
    }
    @media (max-width: 768px) {
      .flasher-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <h2>Dasai Mochi ESP32-C3 Flasher</h2>

  <div class="flasher-container">
    <esp-web-flasher manifest="firmware/manifest.json"></esp-web-flasher>
    <div id="log-output">[ Log Output s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y... ]</div>
  </div>

  <div>
    <h3>üìò H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
    <ul>
      <li>D√πng tr√¨nh duy·ªát <strong>Chrome</strong> ho·∫∑c <strong>Edge</strong> tr√™n m√°y t√≠nh.</li>
      <li>K·∫øt n·ªëi ESP32-C3 v·ªõi m√°y t√≠nh qua USB.</li>
      <li>N·∫øu g·∫∑p l·ªói: gi·ªØ n√∫t <b>BOOT</b> ‚Üí nh·∫•n <b>RESET</b> ‚Üí nh·∫£ n√∫t <b>BOOT</b>.</li>
    </ul>
  </div>

  <div id="readme-container">
    <div id="readme-content">ƒêang t·∫£i README.md...</div>
  </div>

  <script>
    // Log output t·ª´ esp-web-flasher
    const flasher = document.querySelector('esp-web-flasher');
    const logBox = document.getElementById('log-output');

    if (flasher) {
      flasher.addEventListener('log', event => {
        if (event.detail && typeof event.detail === 'string') {
          const timestamp = new Date().toLocaleTimeString();
          logBox.textContent += `[${timestamp}] ${event.detail}\n`;
          logBox.scrollTop = logBox.scrollHeight;
        }
      });
    }

    // Load README.md v√† render Markdown
    async function loadReadme() {
      const readmeDiv = document.getElementById('readme-content');
      try {
        const res = await fetch('README.md');
        if (!res.ok) throw new Error('Kh√¥ng t√¨m th·∫•y file README.md');
        const md = await res.text();
        readmeDiv.innerHTML = marked.parse(md);
      } catch (e) {
        readmeDiv.innerHTML = `<span style="color:red;">L·ªói: ${e.message}</span>`;
      }
    }

    window.onload = () => {
      loadReadme();
    };
  </script>
</body>
</html>
