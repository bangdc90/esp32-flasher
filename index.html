<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dasai Mochi ESP32-C3 Flasher</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 50px; }
    .code { font-family: Consolas, monospace; background: #eee; padding: 8px; }
    #device-list { margin-top: 20px; }
    #device-list li { margin-bottom: 8px; }
    #readme-container { margin-top: 40px; padding: 20px; background: #f9f9f9; border-radius: 8px; }
  </style>
  <!-- Thêm thư viện marked.js để render markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <h2>Dasai Mochi ESP32-C3 Flasher</h2>
  <esp-web-install-button manifest="firmware/manifest.json"></esp-web-install-button>
  <script type="module" src="https://unpkg.com/esp-web-tools@latest/dist/web/install-button.js?module"></script>
  <p>Bạn cần dùng Chrome và kết nối ESP32 qua USB.</p>

  <h3>Các linh kiện cần thiết để làm Dasai Mochi</h3>
  <ul id="device-list">
    <li>Đang tải danh sách...</li>
  </ul>

  <div id="readme-container">
    <h3>Hướng dẫn sử dụng</h3>
    <div id="readme-content">Đang tải README.md...</div>
  </div>

  <script>
    // Hàm load và render danh sách thiết bị từ components.json
    async function loadDeviceList() {
      const ul = document.getElementById('device-list');
      ul.innerHTML = '<li>Đang tải danh sách...</li>';
      try {
        const res = await fetch('components.json');
        if (!res.ok) throw new Error('Không tìm thấy file components.json');
        const devices = await res.json();
        ul.innerHTML = '';
        if (devices.length === 0) {
          ul.innerHTML = '<li>Không có thiết bị nào.</li>';
        } else {
          devices.forEach(d => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${d.name}:</strong> <a href="${d.url}" target="_blank">${d.url}</a>`;
            ul.appendChild(li);
          });
        }
      } catch (e) {
        ul.innerHTML = `<li style="color:red;">Lỗi: ${e.message}</li>`;
      }
    }

    // Hàm load và render README.md với markdown
    async function loadReadme() {
      const readmeDiv = document.getElementById('readme-content');
      try {
        const res = await fetch('README.md');
        if (!res.ok) throw new Error('Không tìm thấy file README.md');
        const md = await res.text();
        readmeDiv.innerHTML = marked.parse(md);
      } catch (e) {
        readmeDiv.innerHTML = `<span style="color:red;">Lỗi: ${e.message}</span>`;
      }
    }

    window.onload = () => {
      loadDeviceList();
      loadReadme();
    };
  </script>
</body>
</html>
